# Migration `20200530093616-make-topic-singule`

This migration has been generated by Yan Takushevich at 5/30/2020, 9:36:16 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Video" ADD COLUMN "topicId" integer  NOT NULL ;

ALTER TABLE "public"."_TopicToVideo" DROP CONSTRAINT IF EXiSTS "_TopicToVideo_A_fkey";

ALTER TABLE "public"."_TopicToVideo" DROP CONSTRAINT IF EXiSTS "_TopicToVideo_B_fkey";

ALTER TABLE "public"."Video" ADD FOREIGN KEY ("topicId")REFERENCES "public"."Topic"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."_TopicToVideo";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200529101223-rename-text-to-label..20200530093616-make-topic-singule
--- datamodel.dml
+++ datamodel.dml
@@ -4,16 +4,17 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Video {
   ytId       String     @id
   snippet    Json
   complexity Complexity
-  topics     Topic[]    @relation(references: [id])
+  topic      Topic      @relation(fields: [topicId], references: [id])
+  topicId    Int
   tags       Tag[]      @relation(references: [id])
   votes      Vote[]
   voteScore  Int?       @default(0)
   uploader   User       @relation("UserVideos", fields: [uploaderId], references: [uid])
@@ -46,9 +47,9 @@
 model Topic {
   id     Int     @default(autoincrement()) @id
   value  String  @unique
   label  String  @unique
-  videos Video[] @relation(references: [ytId])
+  videos Video[]
 }
 model Tag {
   id     Int     @default(autoincrement()) @id
```


