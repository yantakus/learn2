# Migration `20200601134409-add-bookmarkers-relation`

This migration has been generated by Yan Takushevich at 6/1/2020, 1:44:09 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_UserBookmarks" (
"A" text  NOT NULL ,"B" text  NOT NULL )

ALTER TABLE "public"."Video" DROP CONSTRAINT IF EXiSTS "Video_userUid_fkey",
DROP COLUMN "etag",
DROP COLUMN "userUid";

CREATE UNIQUE INDEX "_UserBookmarks_AB_unique" ON "public"."_UserBookmarks"("A","B")

CREATE  INDEX "_UserBookmarks_B_index" ON "public"."_UserBookmarks"("B")

ALTER TABLE "public"."_UserBookmarks" ADD FOREIGN KEY ("A")REFERENCES "public"."User"("uid") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_UserBookmarks" ADD FOREIGN KEY ("B")REFERENCES "public"."Video"("ytId") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200601131931..20200601134409-add-bookmarkers-relation
--- datamodel.dml
+++ datamodel.dml
@@ -4,33 +4,31 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Video {
-  ytId       String     @id
-  snippet    Json
-  etag       String
-  complexity Complexity
-  topic      Topic      @relation(fields: [topicId], references: [id])
-  topicId    Int
-  tags       Tag[]      @relation(references: [id])
-  votes      Vote[]
-  voteScore  Int?       @default(0)
-  uploader   User       @relation("UserVideos", fields: [uploaderId], references: [uid])
-  uploaderId String
-  language   Language   @relation(fields: [languageId], references: [id])
-  languageId Int
-  User       User?      @relation(fields: [userUid], references: [uid])
-  userUid    String?
+  ytId        String     @id
+  snippet     Json
+  complexity  Complexity
+  topic       Topic      @relation(fields: [topicId], references: [id])
+  topicId     Int
+  tags        Tag[]      @relation(references: [id])
+  votes       Vote[]
+  voteScore   Int?       @default(0)
+  uploader    User       @relation("UserVideos", fields: [uploaderId], references: [uid])
+  uploaderId  String
+  bookmarkers User[]     @relation("UserBookmarks")
+  language    Language   @relation(fields: [languageId], references: [id])
+  languageId  Int
 }
 model User {
   uid       String  @id
   videos    Video[] @relation("UserVideos")
-  bookmarks Video[]
+  bookmarks Video[] @relation("UserBookmarks")
   votes     Vote[]
 }
 model Vote {
```


