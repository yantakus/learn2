# Migration `20200527130810-remove-language-and-bookmarkers-from-video`

This migration has been generated by Yan Takushevich at 5/27/2020, 1:08:10 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Video" DROP CONSTRAINT IF EXiSTS "Video_languageId_fkey",
DROP COLUMN "languageId",
ADD COLUMN "userUid" text   ;

ALTER TABLE "public"."Vote" DROP CONSTRAINT IF EXiSTS "Vote_parentId_fkey",
DROP COLUMN "parentId",
ADD COLUMN "videoId" text  NOT NULL ;

ALTER TABLE "public"."_UserBookmarks" DROP CONSTRAINT IF EXiSTS "_UserBookmarks_A_fkey";

ALTER TABLE "public"."_UserBookmarks" DROP CONSTRAINT IF EXiSTS "_UserBookmarks_B_fkey";

ALTER TABLE "public"."Video" ADD FOREIGN KEY ("userUid")REFERENCES "public"."User"("uid") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Vote" ADD FOREIGN KEY ("videoId")REFERENCES "public"."Video"("ytId") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."Language";

DROP TABLE "public"."_UserBookmarks";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200526103828-rename-parent-fields-to-video..20200527130810-remove-language-and-bookmarkers-from-video
--- datamodel.dml
+++ datamodel.dml
@@ -4,40 +4,37 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model Video {
-  ytId        String     @id
-  snippet     Json
-  language    Language   @relation(fields: [languageId], references: [id])
-  languageId  Int
-  complexity  Complexity
-  topics      Topic[]    @relation(references: [id])
-  tags        Tag[]      @relation(references: [id])
-  bookmarkers User[]     @relation("UserBookmarks", references: [uid])
-  votes       Vote[]
-  voteScore   Int?       @default(0)
-  uploader    User       @relation("UserVideos", fields: [uploaderId], references: [uid])
-  uploaderId  String
+  ytId       String     @id
+  snippet    Json
+  complexity Complexity
+  topics     Topic[]    @relation(references: [id])
+  tags       Tag[]      @relation(references: [id])
+  votes      Vote[]
+  voteScore  Int?       @default(0)
+  uploader   User       @relation("UserVideos", fields: [uploaderId], references: [uid])
+  uploaderId String
 }
 model User {
   uid       String  @id
   videos    Video[] @relation("UserVideos")
-  bookmarks Video[] @relation("UserBookmarks")
+  bookmarks Video[]
   votes     Vote[]
 }
 model Vote {
-  id       Int      @default(autoincrement()) @id
-  parent   Video    @relation(fields: [parentId], references: [ytId])
-  parentId String
-  user     User     @relation(fields: [userId], references: [uid])
-  userId   String
-  type     VoteType
+  id      Int      @default(autoincrement()) @id
+  video   Video    @relation(fields: [videoId], references: [ytId])
+  videoId String
+  user    User     @relation(fields: [userId], references: [uid])
+  userId  String
+  type    VoteType
 }
 enum VoteType {
   UP
@@ -57,17 +54,10 @@
   text   String  @unique
   videos Video[] @relation(references: [ytId])
 }
-model Language {
-  id     Int     @default(autoincrement()) @id
-  value  String  @unique
-  text   String  @unique
-  videos Video[]
-}
-
 enum Complexity {
   ELEMENTARY
   BASIC
   ADVANCED
   EXPERT
-}
+}
```


